var waitForFinalEvent=function(){var e={};return function(a,s,t){t||(t="Don't call this twice without a uniqueId"),e[t]&&clearTimeout(e[t]),e[t]=setTimeout(a,s)}}();!function(a){a(function(){"use strict";function s(){a("body").width()<d?"nope"!=localStorage.getItem("asideHidden")&&"undefined"==typeof localStorage||(t.addClass("aside-hidden"),n.find("i").addClass(r).removeClass(l),i.hide(),localStorage.setItem("asideHidden","yep")):"yep"==localStorage.getItem("asideHidden")&&(t.removeClass("aside-hidden"),n.find("i").removeClass(r).addClass(l),i.show(),localStorage.setItem("asideHidden","nope"))}var t=a(".wrap"),o=a("#demo1"),i=a("#js-narrow-menu"),n=a("#js-showhide-menu"),r="fa-eye",l="fa-eye-slash",d=768,c=a("#js-extramenu"),m=a("#extramenu"),u=a("#info-content"),f=a(".js-info-tab-selector");"undefined"!=typeof localStorage&&null!==localStorage&&("yep"==localStorage.getItem("asideNarrow")&&(t.addClass("aside-narrow"),i.find("i").removeClass("fa-bars").addClass("fa-ellipsis-v")),"yep"==localStorage.getItem("asideHidden")&&(t.addClass("aside-hidden"),n.find("i").addClass(r).removeClass(l),i.hide())),"undefined"!=typeof localStorage&&null!==localStorage&&"yep"==localStorage.getItem("extraMenu")&&m.addClass("shown"),i.on("click",function(){var e=a(this);t.hasClass("aside-narrow")?(t.removeClass("aside-narrow"),localStorage.setItem("asideNarrow","nope"),e.find("i").removeClass("fa-ellipsis-v").addClass("fa-bars"),o.navgoco("toggle",!1),o.navgoco("reset")):(t.addClass("aside-narrow"),localStorage.setItem("asideNarrow","yep"),e.find("i").removeClass("fa-bars").addClass("fa-ellipsis-v"),o.navgoco("toggle",!1),o.navgoco("reset"))}),n.on("click",function(){var e=a(this);t.hasClass("aside-hidden")?(t.removeClass("aside-hidden"),e.find("i").removeClass(r).addClass(l),i.show(),localStorage.setItem("asideHidden","nope")):(t.addClass("aside-hidden"),e.find("i").addClass(r).removeClass(l),i.hide(),localStorage.setItem("asideHidden","yep"))}),c.on("click",function(){m.hasClass("shown")?(a("#extramenu-content").hide(),m.removeClass("shown"),localStorage.removeItem("extraMenu")):(m.addClass("shown"),localStorage.setItem("extraMenu","yep")),m.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(e){m.hasClass("shown")&&a("#extramenu-content").show()})}),m.hasClass("shown")?a("#extramenu-content").show():a("#extramenu-content").hide(),a(window).on("resize",function(){waitForFinalEvent(function(){s()},250,"hiddenOnBreakPoint")}),o.length>0&&o.navgoco({caretClassCollapsed:"fa fa-angle-down",caretClassExpanded:"fa fa-angle-up",accordion:!0,openClass:"open",save:!0,cookie:{name:"sidemenuCIMembership",expires:!1,path:"/"},slide:{duration:200,easing:"swing"}}),f.on("show.bs.tab",function(e){f.removeClass("active in"),a(this).addClass("active in"),localStorage.setItem("js-aside-info-active-tab",a(this).attr("id"))}),"undefined"!=typeof localStorage&&null!==localStorage&&(f.removeClass("active in"),a("#"+localStorage.getItem("js-aside-info-active-tab")).addClass("active in"),u.find(".tab-pane.active").removeClass("active in"),u.find(".tab-pane."+localStorage.getItem("js-aside-info-active-tab")).addClass("active in")),a(".js-select-all-members").on("change",function(){var e=this.checked;a(":checkbox").prop("checked",e)}),a(".list_members_checkbox").on("change",function(){a(".js-select-all-members").prop("checked",a(".list_members_checkbox:checked").length==a(".list_members_checkbox").length)}),a(".scroll").length>0&&a(".scroll").slimscroll({distance:"0",color:"#b9b9b9",railVisible:!0,railColor:"#ccc",size:"5px",height:"220px"});a("form#mass_action_form input[type=submit]").click(function(){a("input[type=submit]",a(this).parents("form")).removeAttr("clicked"),a(this).attr("clicked","true")}),a("form#mass_action_form button").on("click",function(e){var s=a(this).attr("name");e.preventDefault(),bootbox.confirm("Warning: <br>"+a(this).data("title"),function(e){e&&(a("input#mass_action").val(s),a("#mass_action_form").submit())})});var h=function(e,s){var t=e.parsley();s.on("click",function(s){t.isValid()?(t.destroy(),e.submit(),a(this).button("loading")):a(this).button("reset"),"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave()})};a(".js-parsley").each(function(e,s){var t=a(this);t.length&&h(t,a("."+t.data("parsley-submit")))}),window.Parsley.addAsyncValidator("parsley_is_db_cell_available",function(e){var a=e.responseText;this.$element.attr("name");return"valid"===a},CONFIG.base_url+"utils/parsley_custom_validation/parsley_is_db_cell_available");var p=a("#fileupload"),g=/^image\/(jpe?g|png)$/i,v={};v[CONFIG.csrf_token_name]=CONFIG.csrf_cookie_name,p.length&&p.fileupload({dropZone:a("#dropzone"),url:CONFIG.base_url+p.attr("data-path"),dataType:"json",disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),maxFileSize:1e3*CONFIG.picture_max_upload_size,acceptFileTypes:g,formData:v,submit:function(){a("#progress").removeClass("hidden"),a("#files").text("")},add:function(e,s){var t=[];s.originalFiles[0].type.length&&!g.test(s.originalFiles[0].type)&&t.push("Not an accepted file type."),s.originalFiles[0].size.toString().length>0&&s.originalFiles[0].size>1e3*CONFIG.picture_max_upload_size&&t.push("Filesize is too big."),t.length>0?a("#files").text(t.join("\n")):s.submit()},done:function(e,s){a.each(s.result.files,function(e,t){var o="";0!=t.error&&(o=t.error);var i=new Date;a("#progress").addClass("hidden"),a("#progress .progress-bar").css("width","0%"),a(".js_profile_image").attr("src",CONFIG.base_url+"assets/img/members/"+a("#profile_username").val()+"/"+s.result.new_name+"?"+i.getTime()),a("#files").text(o)}),Cookies.set("csrf_cookie_name",CONFIG.csrf_cookie_name,{domain:""},{path:"/"});Cookies.get("csrf_cookie_name");a("body").find("input[name=csrf_token_name]").val(CONFIG.csrf_cookie_name)},progressall:function(e,s){var t=parseInt(s.loaded/s.total*100,10);a("#progress .progress-bar").css("width",t+"%")},fail:function(e,s){a("#files").text("File upload is down. Please try again later.")}}).prop("disabled",!a.support.fileInput).parent().addClass(a.support.fileInput?void 0:"disabled"),p.on("click",function(){a("#files").text("")}),a("#js-search").on("click",function(){a("#search_wrapper").hasClass("in")?a("#js-search-text").html('<i class="fa fa-expand pd-r-5"></i> '+LANG.search_expand):a("#js-search-text").html('<i class="fa fa-compress pd-r-5"></i> '+LANG.search_collapse)}),a(".js-confirm-delete").on("click",function(){return!!confirm(LANG.confirm_delete)&&(a(this).button("loading"),!0)}),a(".js-username-from-email").on("change",function(){console.log("in");var e=a(".js-username-from-email-target");e.is(":visible")?(a("#username").removeAttr("data-parsley-required"),e.hide()):(a("#username").attr("data-parsley-required",""),e.show())}),location.hash&&a("a[href='"+location.hash+"']").tab("show"),a(document.body).on("click",".nav-tabs a[data-toggle]",function(e){location.hash=this.getAttribute("href"),localStorage.setItem("lastTab",a(this).attr("href"))});var b=localStorage.getItem("lastTab");b&&a('.nav-tabs a[href="'+b+'"]').tab("show"),a(".js-username-history").on("click",function(e){var s=a(this).data("userid"),t={};t[CONFIG.csrf_token_name]=CONFIG.csrf_cookie_name,a.ajax({method:"POST",url:CONFIG.base_url+"adminpanel/member_detail/get_username_history/"+s,dataType:"json",data:t}).done(function(e){var s=[];a.each(e.resultData,function(e,a){s.push(a.username+"<br>")}),bootbox.dialog({message:s,title:"Username history",buttons:{success:{label:"Close",className:"btn-success"}}}),CONFIG.csrf_cookie_name=e.csrfHash,t[CONFIG.csrf_token_name]=CONFIG.csrf_cookie_name}).fail(function(e,a){console.log(a)})}),a(".dropdown-menu-member").on("click",function(e){console.log("in"),e.stopPropagation()});var C=a("body");C.css("display","none"),C.css("visibility","inherit"),C.fadeIn(400),C.removeClass("notransition"),"#_=_"==window.location.hash&&(window.location.hash="",history.pushState("",document.title,window.location.pathname),e.preventDefault())})}(window.jQuery);